#!/usr/bin/env bash

set -euo pipefail

SCRIPT_DIR="$(cd "$(dirname "${BASH_SOURCE[0]}")" && pwd)"
cd "$SCRIPT_DIR"

COMPOSE_FILE="docker-compose.dev.yaml"

if ! command -v docker >/dev/null 2>&1; then
	echo "docker is required but not installed or not in PATH." >&2
	exit 1
fi

WORKER_SCALE="${WORKER_SCALE:-1}"

echo "Starting development stack using $COMPOSE_FILE (worker scale: $WORKER_SCALE)"

docker compose -f "$COMPOSE_FILE" up --build --remove-orphans --scale worker="$WORKER_SCALE" "$@"
